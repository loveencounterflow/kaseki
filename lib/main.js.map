{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nGUY                       = require 'guy'\n{ alert\n  debug\n  help\n  info\n  plain\n  praise\n  urge\n  warn\n  whisper }               = GUY.trm.get_loggers 'KASEKI'\n{ rpr\n  inspect\n  echo\n  log     }               = GUY.trm\n{ get_kaseki_types }      = require './types'\nCP                        = require 'node:child_process'\nPATH                      = require 'node:path'\n\n\n#===========================================================================================================\nclass Kaseki\n\n  #=========================================================================================================\n  # CONSTRUCTION\n  #---------------------------------------------------------------------------------------------------------\n  constructor: ( cfg ) ->\n    # super()\n    GUY.props.hide @, 'types', get_kaseki_types()\n    @cfg        = @types.create.ksk_constructor_cfg cfg\n    ### TAINT use types ###\n    GUY.props.hide @, 'spawn_cfg',\n      cwd:        @cfg.checkout_path\n      encoding:   'utf-8'\n    return undefined\n\n  #---------------------------------------------------------------------------------------------------------\n  _spawn: ( cmd, parameters... ) -> @_spawn_inner cmd, parameters\n  _spawn_inner: ( cmd, parameters, cfg = null ) ->\n    cfg = if cfg? then { @spawn_cfg..., cfg..., } else @spawn_cfg\n    R   = CP.spawnSync cmd, parameters, cfg\n    if R.status isnt 0\n      if R.error?\n        cmd_line = cmd + ' ' + parameters.join ' '\n        throw new Error \"^kaseki@1^ when trying to execute #{rpr cmd_line} in directory #{cfg.cwd},\" + \\\n          \" an error occurred: #{R.error}\"\n      throw new Error R.stderr\n    return R.stdout.replace /\\n$/, ''\n\n  #---------------------------------------------------------------------------------------------------------\n  get_fossil_version_text: -> @_spawn 'fossil', 'version'\n\n  #---------------------------------------------------------------------------------------------------------\n  list_file_names:  -> ( @_spawn 'fossil', 'ls' ).split '\\n'\n  list_file_paths:  -> ( PATH.join @cfg.checkout_path, name for name in @list_file_names() )\n  status_text:      -> @_spawn 'fossil', 'status'\n\n  #---------------------------------------------------------------------------------------------------------\n  fossil_status: ->\n    ###\n      repository: '/home/flow/3rd-party-repos/fossils/datamill-doc-demo.fossil',\n      local-root: '/home/flow/3rd-party-repos/sqlite-archiver/demo/fossil-unpacked/',\n      config-db:  '/home/flow/.config/fossil.db',\n      checkout:   '56ae7533ba4c93de3e4cd54378e86019e04484d8 2022-12-11 10:58:54 UTC',\n      parent:     'bce48ab77a9432b544577c2b200544bcfcfd2c9c 2022-12-11 10:55:57 UTC',\n      tags:       'trunk',\n      comment:    'first (user: flow)'\n    ###\n    R = @status_text()\n    return { error: R, } unless ( /^[^\\s:]+:\\s+\\S+/ ).test R\n    lines   = R.split '\\n'\n    entries = ( line.split /^([^:]+):\\s+(.*)$/ for line in lines )\n    return  Object.fromEntries ( [ k, v, ] for [ _, k, v, ] in entries )\n\n  #---------------------------------------------------------------------------------------------------------\n  status: ->\n    R = {}\n    for k, v of @fossil_status()\n      switch k\n        when 'repository' then R.repo_path      = v\n        when 'local-root' then R.checkout_path  = v\n        when 'config-db'  then R.cfg_path       = v\n        when 'checkout', 'parent'\n          # '56ae7533ba4c93de3e4cd54378e86019e04484d8 2022-12-11 10:58:54 UTC',\n          unless ( g = ( v.match /^(?<id>[0-9a-f]+)\\s+(?<ts>.+)$/ )?.groups )?\n            throw new Error \"^kaseki@1^ unable to parse ID with timestamp #{rpr v}\"\n          R[ \"#{k}_id\" ] = g.id\n          R[ \"#{k}_ts\" ] = GUY.datetime.srts_from_isots g.ts\n        when 'tags'       then R.tags           = v ### TAINT should split tags, return list ###\n        when 'comment'    then R.comment        = v ### TAINT should parse user name ###\n        else R[ k ] = v\n    return R\n\n#===========================================================================================================\nmodule.exports = { Kaseki, }\n\n\n############################################################################################################\nif module is require.main then do =>\n  FS = require 'node:fs'\n  GUY.temp.with_directory ({ path: repo_home, }) ->\n    GUY.temp.with_directory ({ path: checkout_home, }) ->\n      debug '^34-1^', rpr repo_home\n      debug '^34-1^', rpr checkout_home\n      repo_path     = PATH.join repo_home,     'kaseki-demo.fossil'\n      checkout_path = PATH.join checkout_home\n      ksk           = new Kaseki { repo_path, checkout_path, }\n      # urge  '^34-2^', ksk._spawn_inner 'realpath', [ '.', ], { cwd: repo_home, }\n      # urge  '^34-3^', ksk._spawn_inner 'ls', [ '-AlF', '.', ], { cwd: repo_home, }\n      info  '^34-4^', rpr ksk.get_fossil_version_text()\n      # debug '^34-5^', ksk._spawn 'ls', '-AlF', '.'\n      # debug '^34-6^', ksk._spawn 'realpath', '.'\n      urge  '^34-7^', ksk._spawn 'fossil', 'init', repo_path\n      urge  '^34-7^', ksk._spawn 'fossil', 'open', repo_path\n      urge  '^34-7^', ksk._spawn 'fossil', 'ls'\n      urge  '^34-8^', ksk.list_file_names()\n      urge  '^34-9^', ksk.list_file_paths()\n      urge  '^34-10^', rpr ksk.status_text()\n      urge  '^34-11^', ksk.fossil_status()\n      help  '^34-12^', ksk.status()\n      info  '^34-13^', ( k.padEnd 20 ), v for k, v of ksk.status()\n      urge  '^34-7^', FS.readdirSync repo_home\n      urge  '^34-7^', FS.readdirSync checkout_home\n  return null\n"
  ]
}