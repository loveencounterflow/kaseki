#!/usr/bin/env bash
set -euo pipefail

# branch=$(git rev-parse --abbrev-ref HEAD)
# echo "Branch: $branch"

: <<'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

Sample output:

```
## master...origin/master [ahead 1]
 M lib/main.js
 M lib/main.js.map
 M package.json
 M pnpm-lock.yaml
 M src/main.coffee
1 0
```

In a freshly created project with two files but no commit and no remote:

```
## No commits yet on master
?? a.txt
?? another.txt
fatal: ambiguous argument 'master...origin/master': unknown revision or path not in the working tree.
Use '--' to separate paths from revisions, like this:
'git <command> [<revision>...] -- [<file>...]'
```

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

dev=1

#-----------------------------------------------------------------------------------------------------------
git_status=$(git status -sb)
local_branch=$(sed  -z -E 's/^##\s+(.*?)\.{3}(\S+).*/\1/g' <<< "$git_status")
remote_branch=$(sed -z -E 's/^##\s+(.*?)\.{3}(\S+).*/\2/g' <<< "$git_status")

#-----------------------------------------------------------------------------------------------------------
counts=$(git rev-list --left-right --count "$local_branch"..."$remote_branch")
ahead_count=$(sed  -z -E 's/^\s*([0-9]+)\s+([0-9]+).*/\1/g' <<< "$counts")
behind_count=$(sed -z -E 's/^\s*([0-9]+)\s+([0-9]+).*/\2/g' <<< "$counts")

#-----------------------------------------------------------------------------------------------------------
if [[ "$dev" -eq 1 ]]; then
  echo "$git_status"
  echo '---------------------------------'
  echo "$local_branch"
  echo "$remote_branch"
  echo '---------------------------------'
  echo "$counts"
  echo '---------------------------------'
  echo "$ahead_count"
  echo "$behind_count"
  echo '---------------------------------'
  fi

#-----------------------------------------------------------------------------------------------------------
echo "{ \
\"local_branch\": \"$local_branch\", \
\"remote_branch\": \"$remote_branch\", \
\"ahead_count\": $ahead_count, \
\"behind_count\": $behind_count }"

